# Virtual Rainforest example data

Example data is included with Virtual Rainforest to provide an introduction to the file
formats and configuration. Using this data is described in the [usage](./usage.md)
documentation and this page describes the structure and contents of the example data
folder. It is probably useful to install the `vr_example` directory to a location of
your choice when reading these notes:

```shell
vr_run --install-example /location/path/
```

## Example data directory structure

The `vr_example` directory contains the following sub-directories:

1. The `config` directory contains three configuration files that combine to provide a
   basic complete configuration for the example data.

1. The `data` directory contains NetCDF format files containing the variables required
   to initialise the model and then iterate over a time series.

1. The empty `out` directory is simply used as a location to store model outputs.

1. The `generation_scripts` directory contains Python scripts that are used to generate
   the contents of the `data` directory. You won't typically need to look at these, but
   they provide simple recipes for creating or editing the input data files.

1. A `source` directory that contains files used to create the input data files.

## Configuration files

The example configuration files are:

````{admonition} config/vr_run.toml
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/config/vr_run.toml
```
````

This file configures the models to be used in the simulation and the order in which they
are initialised and updated.

````{admonition} config/data_config.toml
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/config/data_config.toml
```
````

This file configures the initial variables to be loaded and sets the paths to the source
files providing those variables.

````{admonition} config/animal_functional_groups.toml
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/config/animal_functional_groups.toml
```
````

This provides basic configuration for the `animals` model to set functional group
definitions .

````{admonition} config/plant_config.toml
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/config/plant_config.toml
```
````

A similar set of configuration options for the `plants` model.

## Example data files

The [data configuration
file](../../../virtual_rainforest/example_data/config/data_config.toml) sets up the
links between the variables used in the models and the provided data file in which they
are stored. The NetCDF files in the `data` directory are all generated by the Python
scripts provided in the `generation_scripts` directory, which provide some simple
recipes for creating various kinds of input data and saving them in the required format.

```{warning}
All of these data files currently contain artificial data to test the program flow and
data handling of the Virtual Rainforest simulation. Although some values are taken from
real source data, this is **not yet a meaningful real world example dataset**.
```

### Elevation data

````{admonition} elevation_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/elevation_example_data.py
```
````

This code creates
a dummy elevation map from a digital elevation model ([SRTM](https://www2.jpl.nasa.gov/srtm/))
which is required to run, amongst others, the
{mod}`~virtual_rainforest.models.hydrology.hydrology_model`. The initial data covers the
region 4°N 116°E to 5°N 117°E, see
[SAFE wiki](https://safeproject.net/dokuwiki/safe_gis/srtm) for reference and download.
We reduce the initial 30m spatial resolution to match the 9 x 9 grid of the example
simulation while covering an area similar to the climate dummy data.

### Climate data

````{admonition} climate_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/climate_example_data.py
```
````

The dummy climate data for the example simulation is based on monthly ERA5-Land data
which can be downloaded from the [Copernicus climate data store](https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels-monthly-means?tab=overview).

Metadata:

* Muñoz-Sabater,J. et al: ERA5-Land: A state-of-the-art global reanalysis dataset for
  land applications, Earth Syst. Sci. Data,13, 4349-4383, 2021.
  [https://doi.org/10.5194/essd-13-4349-2021](https://doi.org/10.5194/essd-13-4349-2021)
* Product type: Monthly averaged reanalysis
* Variable: 2m dewpoint temperature, 2m temperature, Surface pressure, Total
  precipitation
* Year: 2013, 2014
* Month: January, February, March, April, May, June, July, August, September, October,
  November, December
* Time: 00:00
* Sub-region extraction: North 6°, West 116°, South 4°, East 118°
* Format: NetCDF3

The following section describes the main steps perfomed to create the following input
variables for the Virtual Rainforest:

* air temperature, [C]
* relative humidity, [-]
* atmospheric pressure, [kPa]
* precipitation, [mm month^-1]
* atmospheric $\ce{CO_{2}}$ concentration, [ppm]
* mean annual temperature, [C]

#### Adjustment of units

The standard output unit of ERA5-Land temperatures is Kelvin which needs to be converted
to degree Celsius for the Virtual Rainforest. This includes 2m air temperature and
2m dewpoint temperature which are used to calculate relative humidity later.
The standard output unit for total precipitation in ERA5-Land is meters which we need
to convert to millimeters. Further, the data represents mean daily accumulated
precipitation for the 9x9km grid box, so the value has to be scaled to monthly (here
30 days).
The standard output unit for surface pressure in ERA5-Land is Pascal (Pa) which we
need to convert to Kilopascal (kPa).

#### Addition of missing variables

In addition to the variables from the ERA5-Land data, a time series of atmospheric
$\ce{CO_{2}}$ is needed. We add this here as a constant field across all grid cells and
vertical layers. Mean annual temperature is calculated from the full time series of air
temperatures; in the future, this should be done for each year.

Relative humidity (RH) is also not a standard output from ERA5-Land but can be
calculated from 2m dewpoint temperature (DPT) and 2m air temperature (T) as follows:

$$ RH = \frac{100\exp(17.625 \cdot DPT)/(243.04+DPT)}
                 {\exp(17.625 \cdot T)/(243.04+T)}
$$

#### Matching Virtual Rainforest grid and naming conventions

Once all input units are adjusted, the variables are re-named according to the Virtual
Rainforest naming convention. The coordinate names have to be changed from
`longitude/latitude` to `x/y` and the units from `minutes` to `meters`. The ERA5-Land
coordinates are treated as the centre points of the grid cells which means that when
setting up the grid, an offset of 4.5 km has to be added.

```{note}
The Virtual Rainforest is run on a 90 x 90 m grid. This means that some form of
spatial downscaling has to be applied to the dataset, for example by spatially
interpolating coarser resolution climate data and including the effects of local
topography. This is not yet implemented!
```

For the purpose of a dummy simulation in the development stage, the coordinates can be
overwritten to match the Virtual Rainforest grid and we can select a smaller area.
When setting up the grid, an offset of 45 m has to be added.
Note that the resulting dataset does no longer match a digital elevation model for the
area!

At the moment, the dummy model iterates over time indices rather than real datetime.
Therefore, we add a `time_index` dimension and coordinate to the dataset.

### Hydrology data

````{admonition} runoff_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/runoff_example_data.py
```
````

The hydrology model requires an initial surface runoff field to calculate accumulated
surface runoff. If this variable is not provided by the SPLASH model, it can be created,
for example as a normal distribution, and adjusted to Virtual Rainforest conventions.

### Soil data

````{admonition} soil_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/soil_example_data.py
```
````

This code creates a set of
plausible values for which the {mod}`~virtual_rainforest.models.soil.soil_model`
absolutely has to function sensibly for.
**It is important to note that none of this data is real data**.
Descriptions of the soil pools can be found [here](./soil/soil_details.md).

* pH; we're looking at acidic soils so a range of 3.5-4.5 seems plausible.
* Bulk density can vary quite a lot so a range of 1200-1800 kg m^-3 seems sensible.
* Percent clay; we're considering fairly clayey soils, so look at a range of
  27.0-40.0 % clay
* Low molecular weight carbon (LMWC); generally a very small carbon pool, so a range of
  0.005-0.01 kg C m^-3 is used.
* Mineral associated organic matter (MAOM); a huge amount of carbon can be locked away
  as MAOM, so a range of 1.0-3.0 kg C m^-3 is used.
* Microbial Carbon; the carbon locked up as microbial biomass is tiny, so a range of
  0.0015-0.005 kg C m^-3 is used.
* Particulate organic matter (POM); a reasonable amount of carbon is stored as
  particulate organic matter (POM), so a range of 0.1-1.0 kg C m^-3 is used.

### Litter data

````{admonition} litter_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/litter_example_data.py
```
````

 creates a set of
plausible values for which the {mod}`~virtual_rainforest.models.litter.litter_model`
absolutely has to function sensibly for.
**It is important to note that none of this data is real data**.
Descriptions of the litter pools can be found [here](./soil/soil_details.md).

* above ground metabolic litter pools, [kg C m^-2].
* above ground structural litter pools, [kg C m^-2].
* woody litter pools, [kg C m^-2].
* below ground metabolic litter pools, [kg C m^-2].
* below ground structural litter pools, [kg C m^-2].
* lignin proportions of the pools

### Plant data

````{admonition} plant_example_data.py
:class: dropdown
```{literalinclude} ../../../virtual_rainforest/example_data/generation_scripts/plant_example_data.py
```
````

### Animal data

A set of functional groups for the {mod}`~virtual_rainforest.models.animals.animal_model`
is provided [here](../../../virtual_rainforest/example_data/config/animal_functional_groups.toml).
